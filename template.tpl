___TERMS_OF_SERVICE___

By creating or modifying this file you agree to Google Tag Manager's Community
Template Gallery Developer Terms of Service available at
https://developers.google.com/tag-manager/gallery-tos (or such other URL as
Google may provide), as modified from time to time.


___INFO___

{
  "type": "TAG",
  "id": "cvt_temp_public_id",
  "version": 1,
  "securityGroups": [],
  "displayName": "Elevar Monitoring Criteo Tag",
  "brand": {
    "id": "brand_dummy",
    "displayName": "",
    "thumbnail": "data:image/png;base64,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\u003d"
  },
  "description": "The Criteo Tag adds monitoring to your Criteo Tags. Attach Criteo tag information to your variable errors and notice critical errors immediately.\n\nThe tag is powered by Elevar Monitoring Variables.",
  "categories": ["UTILITY", "ANALYTICS", "TAG_MANAGEMENT"],
  "containerContexts": [
    "WEB"
  ]
}


___TEMPLATE_PARAMETERS___

[
  {
    "type": "TEXT",
    "name": "tagName",
    "displayName": "Tag Name",
    "simpleValueType": true,
    "help": "This should equal the GTM Tag Name. This is used to report what tags were associated to the error to Elevar Monitoring dashboard.",
    "valueValidators": [
      {
        "type": "NON_EMPTY"
      }
    ]
  },
  {
    "type": "TEXT",
    "name": "accountId",
    "displayName": "Criteo Account ID",
    "simpleValueType": true,
    "help": "Enter here the Account ID (also called partner ID) that was provided by Criteo. If you have any questions, contact your Technical Solution manager."
  },
  {
    "type": "TEXT",
    "name": "accountIdVariableName",
    "displayName": "Account ID Variable Name",
    "simpleValueType": true,
    "enablingConditions": [
      {
        "paramName": "accountId",
        "paramValue": "",
        "type": "IS_MACRO_REFERENCE"
      }
    ],
    "valueValidators": [
      {
        "type": "NON_EMPTY"
      }
    ]
  },
  {
    "type": "SELECT",
    "name": "siteType",
    "displayName": "Site Type",
    "macrosInSelect": true,
    "selectItems": [
      {
        "value": "d",
        "displayValue": "Desktop"
      },
      {
        "value": "m",
        "displayValue": "Mobile"
      },
      {
        "value": "t",
        "displayValue": "Table"
      }
    ],
    "simpleValueType": true,
    "help": "The site type should be filled with the version of the website displayed to the user : d for desktop, m for mobile, t for tablet."
  },
  {
    "type": "TEXT",
    "name": "siteTypeVariableName",
    "displayName": "Site Type Variable Name",
    "simpleValueType": true,
    "enablingConditions": [
      {
        "paramName": "siteType",
        "paramValue": "",
        "type": "IS_MACRO_REFERENCE"
      }
    ],
    "valueValidators": [
      {
        "type": "NON_EMPTY"
      }
    ]
  },
  {
    "type": "TEXT",
    "name": "userEmail",
    "displayName": "User Email",
    "simpleValueType": true
  },
  {
    "type": "TEXT",
    "name": "userEmailVariableName",
    "displayName": "User Email Variable Name",
    "simpleValueType": true,
    "enablingConditions": [
      {
        "paramName": "userEmail",
        "paramValue": "",
        "type": "IS_MACRO_REFERENCE"
      }
    ],
    "valueValidators": [
      {
        "type": "NON_EMPTY"
      }
    ]
  },
  {
    "type": "SELECT",
    "name": "pageType",
    "displayName": "Page Type",
    "macrosInSelect": false,
    "selectItems": [
      {
        "value": "HomePage",
        "displayValue": "Home Page"
      },
      {
        "value": "ListingPage",
        "displayValue": "Listing Page"
      },
      {
        "value": "ProductPage",
        "displayValue": "Product Page"
      },
      {
        "value": "BasketPage",
        "displayValue": "Basket Page"
      },
      {
        "value": "SalesConfirmationPage",
        "displayValue": "Sales Confirmation Page"
      }
    ],
    "simpleValueType": true
  },
  {
    "type": "SELECT",
    "name": "listingPageProducts",
    "displayName": "Top 3 product IDs of your listing page.",
    "macrosInSelect": true,
    "selectItems": [],
    "simpleValueType": true,
    "enablingConditions": [
      {
        "paramName": "pageType",
        "paramValue": "ListingPage",
        "type": "EQUALS"
      }
    ],
    "help": "Select the GTM Variable that returns a table containing the top 3 product IDs of the page. Formatted as follows : [\"#First item id#\", \"#Second item id#\", \"#Third item id#\"]"
  },
  {
    "type": "TEXT",
    "name": "listingPageProductsVariableName",
    "displayName": "Top 3 Product Variable Name",
    "simpleValueType": true,
    "enablingConditions": [
      {
        "paramName": "pageType",
        "paramValue": "ListingPage",
        "type": "EQUALS"
      }
    ],
    "valueValidators": [
      {
        "type": "NON_EMPTY"
      }
    ]
  },
  {
    "type": "SELECT",
    "name": "productId",
    "displayName": "Product ID",
    "macrosInSelect": true,
    "selectItems": [],
    "simpleValueType": true,
    "enablingConditions": [
      {
        "paramName": "pageType",
        "paramValue": "ProductPage",
        "type": "EQUALS"
      }
    ]
  },
  {
    "type": "TEXT",
    "name": "productIdVariableName",
    "displayName": "Product ID Variable Name",
    "simpleValueType": true,
    "enablingConditions": [
      {
        "paramName": "pageType",
        "paramValue": "ProductPage",
        "type": "EQUALS"
      }
    ],
    "valueValidators": [
      {
        "type": "NON_EMPTY"
      }
    ]
  },
  {
    "type": "SELECT",
    "name": "basketArray",
    "displayName": "Basket Array",
    "macrosInSelect": true,
    "selectItems": [],
    "simpleValueType": true,
    "enablingConditions": [
      {
        "paramName": "pageType",
        "paramValue": "BasketPage",
        "type": "EQUALS"
      }
    ],
    "help": "Select the GTM Variable that returns a table containing the list of product IDs, unit price and quantity in the user\u0027s basket. Formatted as follows : [{\u0027id\u0027:\u0027#productID1#\u0027, \u0027price\u0027:\u0027#productPrice1#\u0027, \u0027quantity\u0027:\u0027#productQty1#\u0027},{\u0027id\u0027:\u0027#productID2#\u0027, \u0027price\u0027:\u0027#productPrice2#\u0027, \u0027quantity\u0027:\u0027#productQty2#\u0027}]"
  },
  {
    "type": "TEXT",
    "name": "basketArrayVariableName",
    "displayName": "Basket Array Variable Name",
    "simpleValueType": true,
    "enablingConditions": [
      {
        "paramName": "pageType",
        "paramValue": "BasketPage",
        "type": "EQUALS"
      }
    ],
    "valueValidators": [
      {
        "type": "NON_EMPTY"
      }
    ]
  },
  {
    "type": "SELECT",
    "name": "transactionId",
    "displayName": "The Purchase Transaction ID",
    "macrosInSelect": true,
    "selectItems": [],
    "simpleValueType": true,
    "enablingConditions": [
      {
        "paramName": "pageType",
        "paramValue": "SalesConfirmationPage",
        "type": "EQUALS"
      }
    ],
    "help": "Select the GTM Variable that returns the transaction Id of the current transaction. This ID should be unique per transaction."
  },
  {
    "type": "TEXT",
    "name": "transactionIdVariableName",
    "displayName": "Transaction ID Variable Name",
    "simpleValueType": true,
    "enablingConditions": [
      {
        "paramName": "pageType",
        "paramValue": "SalesConfirmationPage",
        "type": "EQUALS"
      }
    ],
    "valueValidators": [
      {
        "type": "NON_EMPTY"
      }
    ]
  },
  {
    "type": "SELECT",
    "name": "salesConfirmationArray",
    "displayName": "Sales Confirmation Array",
    "macrosInSelect": true,
    "selectItems": [],
    "simpleValueType": true,
    "enablingConditions": [
      {
        "paramName": "pageType",
        "paramValue": "SalesConfirmationPage",
        "type": "EQUALS"
      }
    ],
    "help": "Select the GTM Variable that returns a table containing the list of Product IDs, unit price and quantity of the user\u0027s transaction. Formatted as follows : [{\u0027id\u0027:\u0027#productID1#\u0027, \u0027price\u0027:\u0027#productPrice1#\u0027, \u0027quantity\u0027:\u0027#productQty1#\u0027},{\u0027id\u0027:\u0027#productID2#\u0027, \u0027price\u0027:\u0027#productPrice2#\u0027, \u0027quantity\u0027:\u0027#productQty2#\u0027}]"
  },
  {
    "type": "TEXT",
    "name": "salesConfirmationArrayVariableName",
    "displayName": "Sales Confirmation Variable Name",
    "simpleValueType": true,
    "enablingConditions": [
      {
        "paramName": "pageType",
        "paramValue": "SalesConfirmationPage",
        "type": "EQUALS"
      }
    ],
    "valueValidators": [
      {
        "type": "NON_EMPTY"
      }
    ]
  }
]


___SANDBOXED_JS_FOR_WEB_TEMPLATE___

const log = require("logToConsole");
const createQueue = require("createQueue");
const injectScript = require("injectScript");

const CRITEO_URL = "https://dynamic.criteo.com/js/ld/ld.js";
const TAG_INFO = "elevar_gtm_tag_info";
const addTagInformation = createQueue(TAG_INFO);
const pushToCriteo = createQueue('criteo_q');
const variablesUsed = [];

const addVariable = (variable) => {
	if (typeof variable !== 'undefined') variablesUsed.push(variable);
};

const useVariables = (keys) => {
  keys.map(key => {
    const vnKey = key + "VariableName";
    
    addVariable(data[vnKey]);
  });
};

const hasVariables = (keys) => {
  useVariables(keys);  
  if (keys.some(key => typeof data[key] === 'undefined')) {
    return false;
  }
  
  return true;
};

/* ============= */
injectScript(CRITEO_URL + "?a=" + data.accountId);

/* Common Events */
if (hasVariables(['accountId'])) {
  pushToCriteo({ event: 'setAccount', account: data.accountId });
}

if (hasVariables(['siteType'])) {
  pushToCriteo({ event: 'setSiteType', type: data.siteType });
}

if (hasVariables(['userEmail'])) {
  pushToCriteo({ event: 'setEmail', email: data.userEmail });
}

/* Page Specific Events */

// HomePage
if (data.pageType === 'HomePage') {
  pushToCriteo({ event: 'viewHome' });
}

// ListingPage
if (hasVariables(['listingPageProducts'])) {
  pushToCriteo({ event: 'viewCategory', item: data.listingPageProducts });
}

// ProductPage
if (hasVariables(['productId'])) {
  pushToCriteo({ event: 'viewItem', item: data.productId });
}

// BasketPage
if (hasVariables(['basketArray'])) {
  pushToCriteo({ event: 'viewBasket', item: data.basketArray });
}

// SalesConfirmationPage
if (hasVariables(['transactionId', 'salesConfirmationArray'])) {
  pushToCriteo({
    event: 'trackTransaction',
    id: data.transactionId,
    item: data.salesConfirmationArray
  });
}

/* -------------------- */

addTagInformation({
  channel: 'criteo',
  tagName: data.tagName,
  eventId: data.gtmEventId,
  variables: variablesUsed
});

data.gtmOnSuccess();


___WEB_PERMISSIONS___

[
  {
    "instance": {
      "key": {
        "publicId": "access_globals",
        "versionId": "1"
      },
      "param": [
        {
          "key": "keys",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "elevar_gtm_tag_info"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": false
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "criteo_q"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": false
                  }
                ]
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "logging",
        "versionId": "1"
      },
      "param": [
        {
          "key": "environments",
          "value": {
            "type": 1,
            "string": "debug"
          }
        }
      ]
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "inject_script",
        "versionId": "1"
      },
      "param": [
        {
          "key": "urls",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 1,
                "string": "https://dynamic.criteo.com/js/*"
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  }
]


___TESTS___

scenarios:
- name: Common Events - Without Variables
  code: "const mockData = {\n  tagName: \"Criteo - Purchase\",\n  accountId: \"1234567890\"\
    ,\n  userEmail: \"aaron@getelevar.com\",\n  pageType: 'HomePage',\n  siteType:\
    \ 'm',\n  \n  gtmTagId: 2147483645,\n  gtmEventId: 13\n};\n\n// Call runCode to\
    \ run the template's code.\nrunCode(mockData);\n\nconst criteo = window.criteo_q;\n\
    \n// Verify that the tag finished successfully.\nassertApi('gtmOnSuccess').wasCalled();\n\
    assertThat(criteo[0].event).isEqualTo('setAccount');\nassertThat(criteo[0].account).isEqualTo('1234567890');\n\
    assertThat(criteo[1].event).isEqualTo('setSiteType');\nassertThat(criteo[1].type).isEqualTo('m');\n\
    assertThat(criteo[2].event).isEqualTo('setEmail');\nassertThat(criteo[2].email).isEqualTo('aaron@getelevar.com');\n\
    assertThat(criteo[3].event).isEqualTo('viewHome');\n\nassertThat(window[TAG_INFO]).hasLength(1);\n\
    assertThat(window[TAG_INFO][0].variables).hasLength(0);\nassertThat(window[TAG_INFO][0].channel).isEqualTo(\"\
    criteo\");\nassertThat(window[TAG_INFO][0].tagName).isEqualTo(\"Criteo - Purchase\"\
    );\n\n"
- name: Common Events - With Variables
  code: "const mockData = {\n  tagName: \"Criteo - Purchase\",\n  accountId: \"1234567890\"\
    ,\n  userEmail: \"aaron@getelevar.com\",\n  userEmailVariableName: \"dlv - userEmail\"\
    ,\n  pageType: 'HomePage',\n  siteType: 'm',\n  siteTypeVariableName: 'dlv - siteType',\n\
    \  \n  gtmTagId: 2147483645,\n  gtmEventId: 13\n};\n\n// Call runCode to run the\
    \ template's code.\nrunCode(mockData);\n\nconst criteo = window.criteo_q;\n\n\
    // Verify that the tag finished successfully.\nassertApi('gtmOnSuccess').wasCalled();\n\
    assertThat(criteo[0].event).isEqualTo('setAccount');\nassertThat(criteo[0].account).isEqualTo('1234567890');\n\
    assertThat(criteo[1].event).isEqualTo('setSiteType');\nassertThat(criteo[1].type).isEqualTo('m');\n\
    assertThat(criteo[2].event).isEqualTo('setEmail');\nassertThat(criteo[2].email).isEqualTo('aaron@getelevar.com');\n\
    assertThat(criteo[3].event).isEqualTo('viewHome');\n\nassertThat(window[TAG_INFO][0].variables).hasLength(2);\n\
    assertThat(window[TAG_INFO][0].variables).contains('dlv - userEmail');\nassertThat(window[TAG_INFO][0].variables).contains('dlv\
    \ - siteType');\n\n"
- name: Common Events - With Variables returning undefined
  code: "const mockData = {\n  tagName: \"Criteo - Purchase\",\n  accountId: \"1234567890\"\
    ,\n  userEmail: undefined,\n  userEmailVariableName: \"dlv - userEmail\",\n  pageType:\
    \ 'HomePage',\n  siteType: undefined,\n  siteTypeVariableName: 'dlv - siteType',\n\
    \  \n  gtmTagId: 2147483645,\n  gtmEventId: 13\n};\n\n// Call runCode to run the\
    \ template's code.\nrunCode(mockData);\n\nconst criteo = window.criteo_q;\n\n\
    // Verify that the tag finished successfully.\nassertApi('gtmOnSuccess').wasCalled();\n\
    assertThat(criteo).hasLength(2);\nassertThat(criteo[0].event).isEqualTo('setAccount');\n\
    assertThat(criteo[0].account).isEqualTo('1234567890');\nassertThat(criteo[1].event).isEqualTo('viewHome');\n\
    \nassertThat(window[TAG_INFO][0].variables).hasLength(2);\nassertThat(window[TAG_INFO][0].variables).contains('dlv\
    \ - userEmail');\nassertThat(window[TAG_INFO][0].variables).contains('dlv - siteType');\n\
    \n"
- name: Custom Event - Value undefined
  code: "const mockData = {\n  tagName: \"Criteo - Purchase\",\n  accountId: \"1234567890\"\
    ,\n  siteType: 'm',\n  siteTypeVariableName: 'dlv - siteType',\n  userEmail: \"\
    aaron@getelevar.com\",\n  userEmailVariableName: \"dlv - userEmail\",\n  pageType:\
    \ 'ListingPage',\n  listingPageProducts: undefined,\n  listingPageProductsVariableName:\
    \ 'listingProducts',\n  \n  gtmTagId: 2147483645,\n  gtmEventId: 13\n};\n\n//\
    \ Call runCode to run the template's code.\nrunCode(mockData);\n\nconst criteo\
    \ = window.criteo_q;\n\n// Verify that the tag finished successfully.\nassertApi('gtmOnSuccess').wasCalled();\n\
    assertThat(criteo).hasLength(3);\n\nassertThat(window[TAG_INFO]).hasLength(1);\n\
    assertThat(window[TAG_INFO][0].variables).contains('listingProducts');\n\n"
- name: Listing Page
  code: "const mockData = {\n  tagName: \"Criteo - Purchase\",\n  accountId: \"1234567890\"\
    ,\n  siteType: 'm',\n  siteTypeVariableName: 'dlv - siteType',\n  userEmail: \"\
    aaron@getelevar.com\",\n  userEmailVariableName: \"dlv - userEmail\",\n  pageType:\
    \ 'ListingPage',\n  listingPageProducts: ['product 1', 'product 2'],\n  listingPageProductsVariableName:\
    \ 'listingProducts',\n  \n  gtmTagId: 2147483645,\n  gtmEventId: 13\n};\n\n//\
    \ Call runCode to run the template's code.\nrunCode(mockData);\n\nconst criteo\
    \ = window.criteo_q;\n\n// Verify that the tag finished successfully.\nassertApi('gtmOnSuccess').wasCalled();\n\
    assertThat(criteo).hasLength(4);\nassertThat(criteo[3].event).isEqualTo('viewCategory');\n\
    assertThat(criteo[3].item).isEqualTo(['product 1', 'product 2']);\n\nassertThat(window[TAG_INFO]).hasLength(1);\n\
    assertThat(window[TAG_INFO][0].variables).contains('listingProducts');\n\n"
- name: Product Page
  code: "const mockData = {\n  tagName: \"Criteo - Purchase\",\n  pageType: 'ProductPage',\n\
    \  productId: 'product 1',\n  productIdVariableName: 'product ID',\n  \n  gtmTagId:\
    \ 2147483645,\n  gtmEventId: 13\n};\n\n// Call runCode to run the template's code.\n\
    runCode(mockData);\n\nconst criteo = window.criteo_q;\n\n// Verify that the tag\
    \ finished successfully.\nassertApi('gtmOnSuccess').wasCalled();\nassertThat(criteo).hasLength(1);\n\
    assertThat(criteo[0].event).isEqualTo('viewItem');\nassertThat(criteo[0].item).isEqualTo('product\
    \ 1');\n\nassertThat(window[TAG_INFO]).hasLength(1);\nassertThat(window[TAG_INFO][0].variables).contains('product\
    \ ID');\n\n"
- name: Basket Page
  code: "const mockData = {\n  tagName: \"Criteo - Purchase\",\n  pageType: 'BasketPage',\n\
    \  basketArray: ['product 1'],\n  basketArrayVariableName: 'basket products',\n\
    \  \n  gtmTagId: 2147483645,\n  gtmEventId: 13\n};\n\n// Call runCode to run the\
    \ template's code.\nrunCode(mockData);\n\nconst criteo = window.criteo_q;\n\n\
    // Verify that the tag finished successfully.\nassertApi('gtmOnSuccess').wasCalled();\n\
    assertThat(criteo).hasLength(1);\nassertThat(criteo[0].event).isEqualTo('viewBasket');\n\
    assertThat(criteo[0].item).isEqualTo(['product 1']);\n\nassertThat(window[TAG_INFO]).hasLength(1);\n\
    assertThat(window[TAG_INFO][0].variables).contains('basket products');\n\n"
- name: Sales Confirmation Page
  code: "const mockData = {\n  tagName: \"Criteo - Purchase\",\n  pageType: 'ProductPage',\n\
    \  transactionId: 'transaction 1',\n  transactionIdVariableName: 'transaction\
    \ id',\n  salesConfirmationArray: ['product 1', 'product 2'],\n  salesConfirmationArrayVariableName:\
    \ 'purchased products',\n  \n  gtmTagId: 2147483645,\n  gtmEventId: 13\n};\n\n\
    // Call runCode to run the template's code.\nrunCode(mockData);\n\nconst criteo\
    \ = window.criteo_q;\n\n// Verify that the tag finished successfully.\nassertApi('gtmOnSuccess').wasCalled();\n\
    assertThat(criteo).hasLength(1);\nassertThat(criteo[0].event).isEqualTo('trackTransaction');\n\
    assertThat(criteo[0].id).isEqualTo('transaction 1');\nassertThat(criteo[0].item).isEqualTo(['product\
    \ 1', 'product 2']);\n\nassertThat(window[TAG_INFO]).hasLength(1);\nassertThat(window[TAG_INFO][0].variables).hasLength(2);\n\
    assertThat(window[TAG_INFO][0].variables).contains('transaction id', 'purchased\
    \ products');\n\n"
setup: "const log = require('logToConsole');\n\n// Custom window object used by mock\
  \ functions\nlet window = {};\nconst TAG_INFO = 'elevar_gtm_tag_info';\n\n/*\nCreates\
  \ an array in the window with the key provided and\nreturns a function that pushes\
  \ items to that array.\n*/\nmock('createQueue', (key) => {\n  const pushToArray\
  \ = (arr) => (item) => {\n    arr.push(item);\n  };\n  \n  if (!window[key]) window[key]\
  \ = [];\n  return pushToArray(window[key]);\n});"


___NOTES___

Created on 18/02/2020, 18:41:48


